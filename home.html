<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<title>Tokera</title>

<style>
body{
margin:0;
background:#111;
color:white;
font-family:Arial;
}

/* TOP BAR */
#topbar{
background:#1a1a1a;
padding:12px;
display:flex;
justify-content:space-between;
align-items:center;
}

.ticket{color:#ff5555;}

/* CONTENT */
#content{
padding:20px;
text-align:center;
margin-bottom:80px;
}

/* DOWN BAR */
#downbar{
position:fixed;
bottom:0;
width:100%;
background:#1a1a1a;
display:flex;
justify-content:space-around;
padding:12px 0;
}

.downbtn{cursor:pointer;}

/* USERS */
.userCard{
background:#222;
margin:10px;
padding:14px;
border-radius:8px;
}

.online{color:#00ff88;}
.offline{color:#888;}

/* GAMES */
.gamesGrid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
gap:14px;
margin-top:20px;
}

.gameCard{
background:#222;
border-radius:10px;
padding:12px;
text-align:center;
}

.gameIcon{
width:80px;
height:80px;
border-radius:50%;
object-fit:cover;
margin-bottom:8px;
}

.gameName{
font-size:16px;
margin-bottom:8px;
}

.playBtn{
background:#00ff88;
border:none;
border-radius:6px;
padding:8px;
font-size:14px;
cursor:pointer;
width:100%;
}

.playBtn:disabled{
opacity:0.5;
cursor:not-allowed;
}
</style>
</head>

<body>

<div id="topbar">
<div>Tokera</div>
<div id="userInfo">...</div>
</div>

<div id="content">Carregando...</div>

<div id="downbar">
<div class="downbtn" onclick="goHome()">Home</div>
<div class="downbtn" onclick="openUsers()">Users</div>
<div class="downbtn" onclick="openFriends()">Friends</div>
<div class="downbtn" onclick="openShop()">Shop</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
getDatabase,ref,get,set,update,onValue,onDisconnect
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

/* FIREBASE */
const firebaseConfig={
apiKey:"AIzaSyBzWOV7rpIQTB43cJtJMOuSazm6KxfMQP4",
authDomain:"tokera-2244b.firebaseapp.com",
databaseURL:"https://tokera-2244b-default-rtdb.firebaseio.com",
projectId:"tokera-2244b",
storageBucket:"tokera-2244b.firebasestorage.app",
messagingSenderId:"516093605358",
appId:"1:516093605358:web:56b055ec770a9e93270aff"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

const content=document.getElementById("content");
const userInfo=document.getElementById("userInfo");

/* LOGIN */
let usuarioAtual=localStorage.getItem("usuario");

if(!usuarioAtual){
mostrarLogin();
}else{
startApp();
}

function mostrarLogin(){
content.innerHTML=`
<h2>Login</h2>
<input id="nome" placeholder="UsuÃ¡rio"><br><br>
<input id="senha" type="password" placeholder="Senha"><br>
<button onclick="login()">Entrar</button>
`;
}

window.login=async function(){
const nome=document.getElementById("nome").value.trim().toLowerCase();
const senha=document.getElementById("senha").value.trim();

if(!nome||!senha)return alert("Preencha tudo");

const userRef=ref(db,"usuarios/"+nome);
const snap=await get(userRef);

if(snap.exists()){
if((snap.val().senha||"")!==senha){
alert("Senha errada");
return;
}
}else{
await set(userRef,{
senha,
ticket:0,
online:true,
PFP:0,
amigos:{}
});
}

localStorage.setItem("usuario",nome);
usuarioAtual=nome;
startApp();
};

/* START */
async function startApp(){
const onlineRef=ref(db,"usuarios/"+usuarioAtual+"/online");
await set(onlineRef,true);
onDisconnect(onlineRef).set(false);

dailyTicket();

onValue(ref(db,"usuarios/"+usuarioAtual),(snap)=>{
const d=snap.val();

if(d.PFP === undefined){
update(ref(db,"usuarios/"+usuarioAtual),{PFP:0});
}

const pfp = d.PFP==1
? `<img src="https://avatars.githubusercontent.com/u/2505495?v=4"
style="width:32px;height:32px;border-radius:50%;vertical-align:middle;"> `
: "";

userInfo.innerHTML=`
${pfp}
<span class="ticket">ðŸŽŸ ${d.ticket}</span> ${usuarioAtual}
`;
});

goHome();
}

/* DAILY TICKET */
async function dailyTicket(){
const hoje=new Date().toDateString();
if(localStorage.getItem("lastTicket")===hoje)return;

const userRef=ref(db,"usuarios/"+usuarioAtual);
const snap=await get(userRef);
await update(userRef,{ticket:(snap.val().ticket||0)+1});
localStorage.setItem("lastTicket",hoje);
}

/* HOME */
window.goHome=function(){
content.innerHTML=`
<h1>Home</h1>
<p>Jogos disponÃ­veis</p>
`;
};

/* USERS */
window.openUsers=function(){
onValue(ref(db,"usuarios"),(snap)=>{
let html="<h2>Users</h2>";
snap.forEach(userSnap=>{
const nome=userSnap.key;
if(nome===usuarioAtual)return;
const d=userSnap.val();

const img = d.PFP==1
? `<img src="https://avatars.githubusercontent.com/u/2505495?v=4"
style="width:40px;height:40px;border-radius:50%;"><br>`
: "";

html+=`
<div class="userCard">
${img}
<b>${nome}</b>
<span class="${d.online?'online':'offline'}">
(${d.online?'On-line':'Off-line'})
</span>
</div>`;
});
content.innerHTML=html;
});
};

/* FRIENDS */
window.openFriends=function(){
onValue(ref(db,"usuarios/"+usuarioAtual+"/amigos"),async(snap)=>{
let html="<h2>Amigos</h2>";
if(!snap.exists()){
content.innerHTML=html+"<p>Nenhum amigo</p>";
return;
}
for(const nome in snap.val()){
const u=await get(ref(db,"usuarios/"+nome));
const d=u.val();

const img = d.PFP==1
? `<img src="https://avatars.githubusercontent.com/u/2505495?v=4"
style="width:40px;height:40px;border-radius:50%;"><br>`
: "";

html+=`
<div class="userCard">
${img}
${nome}
<span class="${d.online?'online':'offline'}">
(${d.online?'On-line':'Off-line'})
</span>
</div>`;
}
content.innerHTML=html;
});
};

/* SHOP */
window.openShop=async function(){
const userRef=ref(db,"usuarios/"+usuarioAtual);
const snap=await get(userRef);
const d=snap.val();

content.innerHTML=`
<h2>Shop</h2>

<div class="gameCard">
<img class="gameIcon" src="https://avatars.githubusercontent.com/u/2505495?v=4">
<div class="gameName">Gatinho na Cama</div>
<p>Custo: ðŸŽŸ 1</p>

<button class="playBtn"
${d.PFP==1?"disabled":""}
onclick="comprarPFP()">
${d.PFP==1?"Equipado":"Comprar"}
</button>
</div>
`;
};

window.comprarPFP=async function(){
const userRef=ref(db,"usuarios/"+usuarioAtual);
const snap=await get(userRef);
const d=snap.val();

if(d.ticket < 1){
alert("Tickets insuficientes!");
return;
}

await update(userRef,{
ticket:d.ticket-1,
PFP:1
});

alert("Foto de perfil equipada!");
openShop();
};
</script>

</body>
</html>
